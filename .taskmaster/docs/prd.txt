<context>
# Overview  
The Daily Organization App is a smart scheduling application that helps users plan their perfect day by automatically scheduling habits, tasks, and gym sessions around their work schedule and fixed commitments. The app uses a sophisticated scoring algorithm to optimize time allocation based on priority, energy levels, and personal preferences.

The app already has core functionality built including:
- Smart daily planning with automatic optimization
- Habit and task management with priorities
- Gym scheduling logic
- Timeline view with drag-and-drop
- Local-first storage with IndexedDB
- Analytics and history tracking

This PRD focuses on the NEXT PHASE of development: enhancing the app with cloud sync, AI assistant features, and improved user experience.

# Core Features (Existing)
1. **Smart Scheduling Engine** - Multi-factor scoring algorithm for optimal time slot placement
2. **Habit Library** - Persistent habits with frequency, duration, energy levels
3. **Task Management** - Priority-based tasks with due dates and splitting
4. **Gym Logic** - Specialized scheduling with frequency, cooldown, bedtime buffers
5. **Timeline View** - Drag-and-drop interface with lock/complete functionality
6. **Local Storage** - IndexedDB with export/import

# User Experience  
Target Users: Busy professionals and students who want to optimize their daily routines

Key User Flows:
1. Morning: Review today's plan → make adjustments → start day
2. During Day: Complete items → track progress → handle changes
3. Evening: Review completion → see analytics → plan tomorrow
</context>

<PRD>
# Technical Architecture  

## Current Stack
- Frontend: Next.js 16 + TypeScript
- Styling: Tailwind CSS  
- Database: IndexedDB with Dexie (local-first)
- Testing: Jest
- Backend: Supabase (authentication ready)

## New Components Needed
1. **Cloud Sync Service** - Real-time sync between devices using Supabase
2. **AI Assistant Module** - Natural language interface for quick actions
3. **Notification Service** - Push notifications for reminders
4. **Calendar Integration** - Google/Apple Calendar sync

# Development Roadmap  

## Phase 1: Cloud Sync & Multi-Device Support
Leverage the existing Supabase authentication to enable full cloud sync.

### 1.1 Database Schema Migration
- Create Supabase tables mirroring local IndexedDB schema
- Set up Row Level Security (RLS) for user data isolation
- Create migration scripts to sync local data to cloud

### 1.2 Sync Service Implementation
- Build real-time sync using Supabase Realtime
- Implement conflict resolution (last-write-wins with timestamp)
- Add offline queue for changes made without connection
- Enable automatic sync on reconnection

### 1.3 User Data Management
- Migrate habits, tasks, plans to cloud storage
- Keep local cache for offline functionality
- Add sync status indicators in UI

## Phase 2: AI Assistant Integration
Add a conversational AI assistant to enable natural language interactions.

### 2.1 Command Bar Component
- Floating command bar (CMD+K shortcut)
- Natural language input processing
- Quick action suggestions

### 2.2 AI Actions
- "Schedule gym for tomorrow at 7am"
- "Add habit: meditate for 10 minutes every morning"
- "What's my next task?"
- "Reschedule all tasks after 3pm to tomorrow"
- "Show me my completion stats for this week"

### 2.3 Morning Briefing
- AI-generated daily summary on app open
- Highlights for the day
- Suggested schedule optimizations
- Weather and commute considerations (future)

## Phase 3: Smart Notifications
Push notifications to keep users on track.

### 3.1 Notification Types
- Upcoming event reminders (configurable timing)
- Habit streak reminders
- End-of-day review prompts
- Weekly summary digests

### 3.2 Notification Preferences
- Per-habit/task notification settings
- Quiet hours configuration
- Notification frequency limits

## Phase 4: Calendar Integration
Sync with external calendars for complete schedule visibility.

### 4.1 Google Calendar
- OAuth integration
- Two-way sync for fixed events
- Import work schedule automatically

### 4.2 Apple Calendar
- CalDAV integration
- Read-only sync initially
- Export generated plan to calendar

## Phase 5: Enhanced Analytics & Insights
Deep dive into productivity patterns.

### 5.1 Trend Analysis
- Weekly, monthly, yearly completion trends
- Best performing days/times
- Habit correlation analysis

### 5.2 AI-Powered Insights
- "You're most productive on Tuesday mornings"
- "You've been skipping gym on Fridays"
- "Consider moving meditation to after lunch based on your patterns"

### 5.3 Progress Reports
- Weekly email digests
- Shareable progress cards
- Goal tracking with milestones

## Phase 6: Mobile App (Future)
React Native mobile application.

### 6.1 Core Features
- Full parity with web app
- Native notifications
- Widget support (iOS/Android)

### 6.2 Mobile-Specific Features
- Apple Watch/Wear OS companion
- Quick-add from home screen
- Location-based reminders

# Logical Dependency Chain

## Foundation First (Build in Order)
1. **Cloud Sync (Phase 1)** - Required for multi-device and AI features
   - Database schema first
   - Sync service second
   - UI indicators last

2. **AI Assistant (Phase 2)** - Depends on sync for consistent data
   - Command bar UI first (provides visible progress)
   - NLP processing second
   - Action handlers last

3. **Notifications (Phase 3)** - Can run in parallel with Calendar
   - Service worker setup first
   - Notification triggers second
   - Preference UI last

4. **Calendar Integration (Phase 4)** - Independent, can parallelize
   - OAuth flows first
   - Sync logic second
   - UI integration last

5. **Enhanced Analytics (Phase 5)** - Depends on sync history
   - Data aggregation first
   - AI insights second
   - Reports last

6. **Mobile App (Phase 6)** - Depends on stable API
   - Shared component library first
   - Core screens second
   - Platform features last

## Quick Wins for Visible Progress
- Phase 1.1 (Schema) → Enables data foundation
- Phase 2.1 (Command Bar UI) → Visible new feature immediately
- Phase 3.1 (Basic notifications) → User engagement boost

# Risks and Mitigations  

## Technical Challenges
| Risk | Impact | Mitigation |
|------|--------|------------|
| Sync conflicts | Data loss | Implement robust conflict resolution with timestamps |
| AI latency | Poor UX | Use streaming responses, show loading states |
| Calendar API limits | Feature failure | Implement caching, respect rate limits |
| Offline support complexity | User frustration | Use service workers, queue operations |

## MVP Considerations
- **Phase 1 (Sync)** is the true MVP - enables all future features
- **Phase 2.1 (Command Bar)** provides visible progress quickly
- Can ship incrementally - each sub-phase is usable independently

## Resource Constraints
- Single developer: Focus on one phase at a time
- Team: Can parallelize Phases 3 and 4
- Use existing libraries (Supabase, React Query) to reduce custom code

# Appendix  

## API Endpoints Needed
```
# Sync Endpoints
POST   /api/sync/push        - Push local changes
GET    /api/sync/pull        - Pull remote changes
WS     /api/sync/realtime    - Real-time subscription

# AI Endpoints  
POST   /api/ai/process       - Process natural language command
GET    /api/ai/briefing      - Generate morning briefing
POST   /api/ai/suggest       - Get schedule suggestions

# Calendar Endpoints
GET    /api/calendar/events  - Fetch external events
POST   /api/calendar/sync    - Sync plan to calendar
```

## Database Tables (Supabase)
```sql
-- Already exists: auth.users

-- To create:
habits (id, user_id, title, duration, frequency, ...)
tasks (id, user_id, title, duration, priority, due_date, ...)
daily_inputs (id, user_id, date, sleep_start, sleep_end, ...)
plans (id, user_id, date, blocks, stats, ...)
preferences (id, user_id, settings, ...)
sync_log (id, user_id, action, entity, timestamp, ...)
```

## Technology Decisions
- **AI Provider**: OpenAI GPT-4 or Anthropic Claude for NLP
- **Push Notifications**: Web Push API + Firebase Cloud Messaging
- **Calendar**: Google Calendar API + CalDAV for Apple
- **Mobile**: React Native with Expo for faster development
</PRD>
